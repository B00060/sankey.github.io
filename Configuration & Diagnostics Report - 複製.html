import pandas as pd
import plotly.graph_objects as go

# 根據圖中的數據建立DataFrame
data_corrected = {
    'source': [
        '1-塑膠製品', '1-塑膠製品', '1-塑膠製品', '1-塑膠製品', 
        '1-其他化學材料', '1-其他化學材料', '1-其他化學材料', '1-其他化學材料', 
        '1-其他電力設備', '1-其他電力設備', '1-其他電力設備', '1-其他電力設備',
        '1-紙張、紙及紙板製品', '1-紙張、紙及紙板製品', '1-紙張、紙及紙板製品', '1-紙張、紙及紙板製品',
        '1-成衣及服飾品', '1-成衣及服飾品', '1-成衣及服飾品', '1-成衣及服飾品',
        '1-半導體', '1-半導體', '1-半導體', '1-半導體',
        '1-化學製品', '1-化學製品', '1-化學製品', '1-化學製品',
        '1-其他五金製品', '1-其他五金製品', '1-其他五金製品', '1-其他五金製品',
        '1-非金屬礦物製品', '1-非金屬礦物製品', '1-非金屬礦物製品', '1-非金屬礦物製品'
    ],
    'target': [
        '2-地毯及墊', '2-電腦、電子及光學產品', '2-塑膠製品', '2-建築工程', 
        '2-住居及餐飲', '2-其他化學材料', '2-其他五金製品', '2-機械裝備', 
        '2-地毯及墊', '2-地毯及墊', '2-地毯及墊', '2-地毯及墊', 
        '2-住居及餐飲', '2-住居及餐飲', '2-住居及餐飲', '2-住居及餐飲', 
        '2-住居及餐飲', '2-住居及餐飲', '2-住居及餐飲', '2-住居及餐飲',
        '2-電腦、電子及光學產品', '2-電腦、電子及光學產品', '2-電腦、電子及光學產品', '2-電腦、電子及光學產品',
        '2-塑膠製品', '2-塑膠製品', '2-塑膠製品', '2-塑膠製品',
        '2-建築工程', '2-建築工程', '2-建築工程', '2-建築工程',
        '2-住居及餐飲', '2-住居及餐飲', '2-住居及餐飲', '2-住居及餐飲'
    ],
    'value': [
        370903.42, 29820.90, 21293.84, 8336.51, 
        6573.94, 6002.29, 3715.70, 3096.42, 
        32342.78, 27224.31, 24665.08, 10978.74,
        9050.94, 5176.91, 3110.32, 405.26,
        808.15, 405.56, 4157.81, 3271.85,
        1310.79, 652.58, 1716.59, 1755.67,
        540.21, 469.35, 428.50, 225.09,
        293.06, 293.06, 293.06, 293.06,
        293.06, 293.06, 293.06, 293.06
    ]
}

# 重新建立DataFrame
df_corrected = pd.DataFrame(data_corrected)

# 設置桑基圖節點
all_nodes_corrected = list(set(df_corrected['source'].unique()).union(set(df_corrected['target'].unique())))
node_indices_corrected = {node: i for i, node in enumerate(all_nodes_corrected)}

# 建立Plotly桑基圖
fig_corrected = go.Figure(go.Sankey(
    node=dict(
        pad=15,
        thickness=20,
        line=dict(color="black", width=0.5),
        label=all_nodes_corrected,
        color="blue"
    ),
    link=dict(
        source=[node_indices_corrected[src] for src in df_corrected['source']],
        target=[node_indices_corrected[tgt] for tgt in df_corrected['target']],
        value=df_corrected['value']
    )
))

fig_corrected.update_layout(title_text="塑膠資源流布分析", font_size=10)
fig_corrected.show()
